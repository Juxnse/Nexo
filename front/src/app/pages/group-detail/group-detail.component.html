<div class="group-detail">
  <div class="group-header" *ngIf="group">
    <h2>{{ group.name }}</h2>
    <p class="description">{{ group.description }}</p>
    <p class="location">{{ group.city }}, {{ group.country }}</p>
  </div>

  <!-- Tabs -->
  <nav class="tabs">
    <button
      class="tab-btn"
      [class.active]="activeTab === 'posts'"
      (click)="setTab('posts')"
    >
      <i class="fa-solid fa-pen-nib"></i>
      Posts
    </button>

    <button
      class="tab-btn"
      [class.active]="activeTab === 'members'"
      (click)="setTab('members')"
    >
      <i class="fa-solid fa-users"></i>
      Members
    </button>

    <button
      class="tab-btn"
      [class.active]="activeTab === 'events'"
      (click)="setTab('events')"
    >
      <i class="fa-solid fa-calendar-days"></i>
      Events
    </button>

    <!-- Animated Line -->
    <div class="tab-indicator" [ngStyle]="getTabIndicatorStyle()"></div>
  </nav>

  <!-- Dynamic Content -->
  <div class="tab-content">
    <!-- POSTS -->
    <ng-container *ngIf="activeTab === 'posts'">
      <div class="create-post">
        <textarea
          [(ngModel)]="newPost"
          placeholder="Write your post..."
        ></textarea>
        <button
          (click)="createPost()"
          [disabled]="creatingPost || !newPost.trim()"
        >
          {{ creatingPost ? 'Posting...' : 'Post' }}
        </button>
      </div>

      <div *ngIf="!loadingPosts && posts.length === 0">
        No posts yet.
      </div>

      <div class="post-card" *ngFor="let post of posts">
        <div class="author">
          <img
            *ngIf="post.author.picture"
            [src]="post.author.picture"
            alt="avatar"
          />
          <strong>{{ post.author.name || post.author.email }}</strong>
          <span>{{ post.created_at | date: 'short' }}</span>
        </div>
        <p>{{ post.content }}</p>
      </div>
    </ng-container>

    <!-- MEMBERS -->
    <ng-container *ngIf="activeTab === 'members'">
      <div *ngIf="!loadingMembers && members.length === 0">
        No members yet.
      </div>

      <div class="join-group" *ngIf="currentUserId && !isMemberActive()">
        <button (click)="joinGroup()" [disabled]="joining">
          {{ joining ? 'Joining...' : 'Join Group' }}
        </button>
      </div>

      <div class="member-card" *ngFor="let m of members">
        <div class="id">
          <img *ngIf="m.user.picture" [src]="m.user.picture" alt="avatar" />
          <div class="avatar" *ngIf="!m.user.picture">
            {{ (m.user.name || m.user.email) | slice: 0:1 | uppercase }}
          </div>

          <div class="meta">
            <strong class="name">{{ m.user.name || m.user.email }}</strong>
            <small *ngIf="m.user.name" class="email"> {{ m.user.email }}</small>
          </div>
        </div>

        <span class="pill role" [ngClass]="'role--' + (m.role || 'member')">
          {{ m.role | titlecase }}
        </span>
        <span
          class="pill status"
          [ngClass]="'status--' + (m.status || 'active')"
        >
          {{ m.status | titlecase }}
        </span>
      </div>
    </ng-container>

    <!-- EVENTS -->
    <ng-container *ngIf="activeTab === 'events' && group?.id">
      <app-group-events [groupId]="group!.id"></app-group-events>
    </ng-container>
  </div>
</div>
